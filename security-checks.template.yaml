# ⚠️ DEPRECATION WARNING ⚠️
# This template is DEPRECATED and will be removed in a future version.
# Please migrate to the new unified trivy-scanning.template.yaml
# 
# Migration guide:
# Replace this:
#   extends: .container_scanning
# With this:
#   extends: .trivy_scanning
#   variables:
#     IMAGE: "your-image:tag"  # Required for image scanning
#     DIRECTORY: "./"          # Required for filesystem scanning
#     PLUGIN_SEVERITY_VULN: "HIGH,CRITICAL"
#     PLUGIN_SEVERITY_MISCONFIG: "HIGH,CRITICAL"
#     PLUGIN_PKG_TYPES_VULN: "os,library"
#
# For more information, see: https://github.com/ambient-innovation/trivy-scanner-templates/releases/latest

.container_scanning:
  extends: .trivy_scanning
  variables:
    # Deprecated: Use the new trivy_scanning template directly
    PLUGIN_SEVERITY_VULN: "HIGH,CRITICAL"
    PLUGIN_SEVERITY_MISCONFIG: "HIGH,CRITICAL"
    PLUGIN_PKG_TYPES_VULN: "os,library"
    # Override scanner types for security scanning
    TRIVY_SCANNERS: "vuln,misconfig"
    TRIVY_TEMPLATE_VERSION: "v25.08.05.0"
  before_script:
    # Show deprecation warning
    - echo "⚠️  WARNING: The .container_scanning template is DEPRECATED!"
    - echo "⚠️  Please migrate to .trivy_scanning template."
    - echo "⚠️  See migration guide: https://github.com/ambient-innovation/trivy-scanner-templates/releases/latest"
    - echo "⚠️  This template will be removed in a future version."
    - echo "⚠️  Note: Security scanning supports both IMAGE and DIRECTORY variables!"
    - echo ""
    # Call parent before_script
    - !reference [.trivy_scanning, before_script]

# Include the new unified template
include:
  - remote: "https://github.com/ambient-innovation/gitlab-trivy-codequality-template/releases/download/${TRIVY_TEMPLATE_VERSION}/trivy-scanning.template.yaml"
